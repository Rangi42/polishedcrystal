name: "Nightly Build"

on:
  schedule:
    - cron: '0 5 * * *'

jobs:
  build:
    name: "Build"
    uses: Rangi42/polishedcrystal/.github/workflows/build.yml@master
  release:
    name: "Release"
    runs-on: ubuntu-latest
    needs: build
    steps:
      # DOWNLOAD BUILD ARTIFACTS
      - id: download-polishedcrystal
        name: "Download polishedcrystal"
        uses: actions/download-artifact@v3.0.0
        with:
          name: "polishedcrystal"
      - id: download-polishedcrystal-faithful
        name: "Download polishedcrystal-faithful"
        uses: actions/download-artifact@v3.0.0
        with:
          name: "polishedcrystal-faithful"
      - id: download-polisheddebug
        name: "Download polisheddebug"
        uses: actions/download-artifact@v3.0.0
        with:
          name: "polisheddebug"
      - id: download-polisheddebug-faithful
        name: "Download polisheddebug-faithful"
        uses: actions/download-artifact@v3.0.0
        with:
          name: "polisheddebug-faithful"
      - id: download-polishedcrystal-savepatch
        name: "Download polishedcrystal-savepatch"
        uses: actions/download-artifact@v3.0.0
        with:
          name: "polishedcrystal-savepatch"
      
      # RELEASE
      - id: release
        name: "Automated Release"
        uses: marvinpinto/action-automatic-releases@latest
        with:
          repo_token: "${{ secrets.GITHUB_TOKEN }}"
          automatic_release_tag: "v3.0.0-beta-nightly"
          title: "v3.0.0 beta nightly"
          prerelease: true
          files: |
            *.gbc
            *.sym
            *.patch
            *.bsp
