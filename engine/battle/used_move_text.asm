
MoveTable:
	; RBYGSC moves
;	dw POUND
;	dw KARATE_CHOP
;	dw DOUBLE_SLAP
;	dw COMET_PUNCH
;	dw PAY_DAY
;	dw FIRE_PUNCH
;	dw ICE_PUNCH
;	dw THUNDERPUNCH
;	dw SCRATCH
;	dw GUILLOTINE
;	dw RAZOR_WIND
;	dw SWORDS_DANCE
;	dw CUT
;	dw GUST
;	dw WING_ATTACK
;	dw WHIRLWIND
;	dw FLY
;	dw BIND
;	dw VINE_WHIP
;	dw STOMP
;	dw DOUBLE_KICK
;	dw JUMP_KICK
;	dw ROLLING_KICK
;	dw SAND_ATTACK
;	dw HEADBUTT
;	dw HORN_ATTACK
;	dw HORN_DRILL
;	dw TACKLE
;	dw BODY_SLAM
;	dw WRAP
;	dw TAKE_DOWN
;	dw THRASH
;	dw DOUBLE_EDGE
;	dw TAIL_WHIP
;	dw POISON_STING
;	dw TWINEEDLE
;	dw PIN_MISSILE
;	dw LEER
;	dw BITE
;	dw GROWL
;	dw ROAR
;	dw SING
;	dw SUPERSONIC
;	dw SONIC_BOOM
;	dw DISABLE
;	dw ACID
;	dw EMBER
;	dw FLAMETHROWER
;	dw MIST
;	dw WATER_GUN
;	dw HYDRO_PUMP
;	dw SURF
;	dw ICE_BEAM
;	dw BLIZZARD
;	dw PSYBEAM
;	dw BUBBLE_BEAM
;	dw AURORA_BEAM
;	dw HYPER_BEAM
;	dw PECK
;	dw DRILL_PECK
;	dw LOW_KICK
;	dw COUNTER
;	dw SEISMIC_TOSS
;	dw STRENGTH
;	dw ABSORB
;	dw MEGA_DRAIN
;	dw LEECH_SEED
;	dw GROWTH
;	dw RAZOR_LEAF
;	dw SOLAR_BEAM
;	dw POISONPOWDER
;	dw STUN_SPORE
;	dw SLEEP_POWDER
;	dw PETAL_DANCE
;	dw STRING_SHOT
;	dw DRAGON_RAGE
;	dw FIRE_SPIN
;	dw THUNDERSHOCK
;	dw THUNDERBOLT
;	dw THUNDER_WAVE
;	dw THUNDER
;	dw ROCK_THROW
;	dw EARTHQUAKE
;	dw FISSURE
;	dw DIG
;	dw TOXIC
;	dw CONFUSION
;	dw PSYCHIC_M
;	dw HYPNOSIS
;	dw MEDITATE
;	dw AGILITY
;	dw QUICK_ATTACK
;	dw RAGE
;	dw TELEPORT
;	dw NIGHT_SHADE
;	dw SCREECH
;	dw DOUBLE_TEAM
;	dw RECOVER
;	dw HARDEN
;	dw MINIMIZE
;	dw SMOKESCREEN
;	dw CONFUSE_RAY
;	dw WITHDRAW
;	dw DEFENSE_CURL
;	dw BARRIER
;	dw LIGHT_SCREEN
;	dw HAZE
;	dw REFLECT
;	dw FOCUS_ENERGY
;	dw METRONOME
;	dw SELFDESTRUCT
;	dw EGG_BOMB
;	dw LICK
;	dw SLUDGE
;	dw FIRE_BLAST
;	dw WATERFALL
;	dw CLAMP
;	dw SWIFT
;	dw SKULL_BASH
;	dw SPIKE_CANNON
;	dw CONSTRICT
;	dw AMNESIA
;	dw FRESH_SNACK                      ; NEEDS POINTER
;	dw HI_JUMP_KICK
;	dw GLARE
;	dw DREAM_EATER
;	dw POISON_GAS
;	dw BARRAGE
;	dw LEECH_LIFE
;	dw LOVELY_KISS
;	dw SKY_ATTACK
;	dw TRANSFORM
;	dw BUBBLE
;	dw DIZZY_PUNCH
;	dw SPORE
;	dw FLASH
;	dw SPLASH
;	dw ACID_ARMOR
;	dw CRABHAMMER
;	dw EXPLOSION
;	dw FURY_SWIPES                      ; NEEDS POINTER
;	dw BONEMERANG
;	dw REST
;	dw ROCK_SLIDE
;	dw HYPER_FANG
;	dw CONVERSION
;	dw TRI_ATTACK
;	dw SUPER_FANG
;	dw SLASH
;	dw SUBSTITUTE


;- gen2 moves
;	dw SKETCH
;	dw THIEF
;	dw SPIDER_WEB
;	dw MIND_READER
;	dw FLAME_WHEEL
;	dw CURSE
;	dw FLAIL
;	dw AEROBLAST
;	dw COTTON_SPORE
;	dw REVERSAL
;	dw POWDER_SNOW
;	dw PROTECT
;	dw MACH_PUNCH
;	dw SCARY_FACE
;	dw FEINT_ATTACK
;	dw SWEET_KISS
;	dw BELLY_DRUM
;	dw SLUDGE_BOMB
;	dw MUD_SLAP
;	dw OCTAZOOKA
;	dw SPIKES
;	dw ZAP_CANNON
;	dw FORESIGHT
;	dw DESTINY_BOND
;	dw PERISH_SONG
;	dw ICY_WIND
;	dw DETECT
;	dw LOCK_ON
;	dw OUTRAGE
;	dw SANDSTORM
;	dw GIGA_DRAIN
;	dw ENDURE
;	dw CHARM
;	dw ROLLOUT
;	dw FALSE_SWIPE
;	dw SWAGGER
;	dw MILK_DRINK
;	dw SPARK
;	dw STEEL_WING
;	dw MEAN_LOOK
;	dw ATTRACT
;	dw SLEEP_TALK
;	dw HEAL_BELL
;	dw RETURN
;	dw FRUSTRATION
;	dw SAFEGUARD
;	dw PAIN_SPLIT
;	dw SACRED_FIRE
;	dw MAGNITUDE
;	dw DYNAMICPUNCH
;	dw MEGAHORN
;	dw DRAGONBREATH
;	dw BATON_PASS
;	dw ENCORE
;	dw PURSUIT
;	dw RAPID_SPIN
;	dw SWEET_SCENT
;	dw IRON_TAIL
;	dw METAL_CLAW
;	dw VITAL_THROW
;	dw MORNING_SUN
;	dw MOONLIGHT
;	dw HIDDEN_POWER
;	dw CROSS_CHOP
;	dw TWISTER
;	dw RAIN_DANCE
;	dw SUNNY_DAY
;	dw CRUNCH
;	dw MIRROR_COAT
;	dw EXTREMESPEED
;	dw ANCIENTPOWER
;	dw SHADOW_BALL
;	dw FUTURE_SIGHT
;	dw ROCK_SMASH
;	dw WHIRLPOOL

;- gen3 moves
;	dw FAKE_OUT
;	dw HAIL
;	dw WILL_O_WISP
;	dw FACADE
;	dw TRICK
;	dw SUPERPOWER
;	dw MAGIC_COAT
;	dw RECYCLE
;	dw REVENGE
;	dw KNOCK_OFF
;	dw ENDEAVOR
;	dw ERUPTION
;	dw SKILL_SWAP
;	dw DIVE
;	dw BLAZE_KICK
;	dw ICE_BALL
;	dw HYPER_VOICE
;	dw POISON_FANG
;	dw ASTONISH
;	dw WEATHER_BALL
;	dw AIR_CUTTER
;	dw OVERHEAT
;	dw ROCK_TOMB
;	dw SILVER_WIND
;	dw METAL_SOUND
;	dw WATER_SPOUT
;	dw SIGNAL_BEAM
;	dw SHADOW_PUNCH
;	dw EXTRASENSORY
;	dw SAND_TOMB
;	dw SHEER_COLD
;	dw MUDDY_WATER
;	dw BULLET_SEED
;	dw AERIAL_ACE
;	dw ICICLE_SPEAR
;	dw IRON_DEFENSE
;	dw BLOCK
;	dw DRAGON_CLAW
;	dw BULK_UP
;	dw BOUNCE
;	dw MUD_SHOT
;	dw MAGICAL_LEAF
;	dw CALM_MIND
;	dw LEAF_BLADE
;	dw DRAGON_DANCE
;	dw ROCK_BLAST
;	dw SHOCK_WAVE
;	dw WATER_PULSE

;- gen4 moves
;	dw ROOST
;	dw GRAVITY
;	dw GYRO_BALL
;	dw BRINE
;	dw METAL_BURST
;	dw U_TURN
;	dw CLOSE_COMBAT
;	dw GASTRO_ACID
;	dw LUCKY_CHANT
;	dw WORRY_SEED
;	dw SUCKER_PUNCH
;	dw TOXIC_SPIKES
;	dw FLARE_BLITZ
;	dw AURA_SPHERE
;	dw ROCK_POLISH
;	dw POISON_JAB
;	dw DARK_PULSE
;	dw NIGHT_SLASH
;	dw AQUA_TAIL
;	dw SEED_BOMB
;	dw AIR_SLASH
;	dw X_SCISSOR
;	dw BUG_BUZZ
;	dw DRAGON_PULSE
;	dw POWER_GEM
;	dw DRAIN_PUNCH
;	dw VACUUM_WAVE
;	dw FOCUS_BLAST
;	dw ENERGY_BALL
;	dw BRAVE_BIRD
;	dw EARTH_POWER
;	dw GIGA_IMPACT
;	dw NASTY_PLOT
;	dw BULLET_PUNCH
;	dw AVALANCHE
;	dw ICE_SHARD
;	dw SHADOW_CLAW
;	dw THUNDER_FANG
;	dw ICE_FANG
;	dw FIRE_FANG
;	dw SHADOW_SNEAK
;	dw MUD_BOMB
;	dw PSYCHO_CUT
;	dw ZEN_HEADBUTT
;	dw MIRROR_SHOT
;	dw FLASH_CANNON
;	dw TRICK_ROOM
;	dw DRACO_METEOR
;	dw LEAF_STORM
;	dw POWER_WHIP
;	dw CROSS_POISON
;	dw GUNK_SHOT
;	dw IRON_HEAD
;	dw MAGNET_BOMB
;	dw STONE_EDGE
;	dw GRASS_KNOT
;	dw BUG_BITE
;	dw WOOD_HAMMER
;	dw AQUA_JET
;	dw HEAD_SMASH
;	dw OMINOUS_WIND

;- gen5 moves
;	dw HONE_CLAWS
	dw PSYSHOCK
;	dw VENOSHOCK
	dw QUIVER_DANCE
	dw SOAK
;	dw FLAME_CHARGE
	dw SIMPLE_BEAM
	dw CLEAR_SMOG
;	dw SCALD
;	dw SHELL_SMASH
;	dw HEX
;	dw ACROBATICS
	dw INFERNO
;	dw VOLT_SWITCH
	dw STRUGGLE_BUG
;	dw BULLDOZE
	dw ELECTROWEB
;	dw WILD_CHARGE
	dw DRILL_RUN
	dw DUAL_CHOP
	dw HORN_LEECH
	dw RAZOR_SHELL
;	dw PSYSTRIKE
;	dw HURRICANE
	dw SNARL
;	dw ICICLE_CRASH

;- gen6 moves
;	dw DISARM_VOICE
;	dw DRAINING_KISS
;	dw PLAY_ROUGH
	dw FAIRY_WIND
;	dw MOONBLAST
;	dw DAZZLINGLEAM
	dw NUZZLE
	dw INFESTATION
	dw POWERUPPUNCH

;- gen7 moves
	dw FIRSTIMPRESS
	dw SOLAR_BLADE
	dw BURN_UP

;- gen8 moves
	dw BREAK_SWIPE
	dw FLIP_TURN

	dw NO_MOVE

DisplayUsedMoveText:
;	jr .no_animate_all_moves ; comment this out for testing all move animations
	ld de, MoveTable
.loop
	ld a, BATTLE_VARS_MOVE
	call GetBattleVarAddr
	ld a, [de]
	ld c, a
	inc de
	ld a, [de]
	ld b, a
	inc de
	or c
	ret z
	push hl
	ld h, b
	ld l, c
	call GetMoveIDFromIndex
	pop hl
	ld [hl], a

	call GetMoveIndexFromID
	ld a, h
	assert HIGH(SOLAR_BEAM) == 0
	and a
	jr nz, .cphl_solar_beam
	ld a, l
	assert LOW(SOLAR_BEAM) != 0
	cp LOW(SOLAR_BEAM)
.cphl_solar_beam
	jr z, .chargeup_moves
	ld a, h
	assert HIGH(DIG) == 0
	and a
	jr nz, .cphl_dig
	ld a, l
	assert LOW(DIG) != 0
	cp LOW(DIG)
.cphl_dig
	jr z, .chargeup_moves
	ld a, h
	assert HIGH(CURSE) == 0
	and a
	jr nz, .cphl_curse
	ld a, l
	assert LOW(CURSE) != 0
	cp LOW(CURSE)
.cphl_curse
	jr z, .chargeup_moves
	ld a, h
	assert HIGH(FLY) == 0
	and a
	jr nz, .cphl_fly
	ld a, l
	assert LOW(FLY) != 0
	cp LOW(FLY)
.cphl_fly
	jr z, .chargeup_moves
	ld a, h
	assert HIGH(SUBSTITUTE) == 0
	and a
	jr nz, .cphl_substitute
	ld a, l
	assert LOW(SUBSTITUTE) != 0
	cp LOW(SUBSTITUTE)
.cphl_substitute
	jr nz, .done_special_handling

	call .DoMoveAnim
	push hl
	push de
	ld a, BATTLE_VARS_SUBSTATUS4
	call GetBattleVarAddr
	ld a, [hl]
	push hl
	push af
	set SUBSTATUS_SUBSTITUTE, [hl]
	farcall BattleCommand_lowersub
	pop af
	pop hl
	ld [hl], a
	pop de
	pop hl
	jr .loop

.chargeup_moves
	ld a, 1
	ld [wBattleAnimParam], a
	call .DoMoveAnim
	xor a
	ld [wBattleAnimParam], a
	; fallthrough
.done_special_handling
	call .DoMoveAnim
	jr .loop

.DoMoveAnim
	push hl
	push de
	farcall UpdateMoveData
	call .no_animate_all_moves
	farcall AnimateCurrentMove
	pop de
	pop hl
	ret

.no_animate_all_moves
	ld a, BATTLE_VARS_SUBSTATUS2
	call GetBattleVar
	bit SUBSTATUS_IN_ABILITY, a
	ret nz

	ldh a, [hBattleTurn]
	and a
	jr nz, .start

	ld a, [wPlayerMoveStruct + MOVE_ANIM]
	call UpdateUsedMoves

.start
	ld a, BATTLE_VARS_LAST_MOVE
	call GetBattleVarAddr

	ld a, BATTLE_VARS_MOVE_ANIM
	call GetBattleVar
	ld [wMoveGrammar], a

	; Skip last move update if move was called (1=called, 2=Power Herb)
	ldh a, [hBattleTurn]
	and a
	ld a, [wPlayerCharging]
	jr z, .got_charging
	ld a, [wEnemyCharging]
.got_charging
	dec a
	jr z, .charging

	; update last move
	push hl
	ld a, BATTLE_VARS_LAST_COUNTER_MOVE
	call GetBattleVarAddr
	ld a, [wMoveGrammar]
	ld [hl], a
	pop hl
	ld [hl], a

.charging
	; check obedience
	ld hl, UsedMoveText
	ld a, [wAlreadyDisobeyed]
	and a
	jr z, .ok
	ld hl, UsedMoveInsteadText
.ok
	call StdBattleTextbox
	jmp ApplyTilemapInVBlank

UpdateUsedMoves:
; append move a to wPlayerUsedMoves unless it has already been used

	push bc
; start of list
	ld hl, wPlayerUsedMoves
; get move id
	ld b, a
; next count
	ld c, NUM_MOVES

.loop
; get move from the list
	ld a, [hli]
; not used yet?
	and a
	jr z, .add
; already used?
	cp b
	jr z, .quit
; next byte
	dec c
	jr nz, .loop

; if the list is full and the move hasn't already been used
; shift the list back one byte, deleting the first move used
; this can occur with struggle or a new learned move
	ld hl, wPlayerUsedMoves + 1
; 1 = 2
	ld a, [hld]
	ld [hli], a
; 2 = 3
	inc hl
	ld a, [hld]
	ld [hli], a
; 3 = 4
	inc hl
	ld a, [hld]
	ld [hl], a
; 4 = new move
	ld a, b
	ld [wPlayerUsedMoves + 3], a
	jr .quit

.add
; go back to the byte we just inced from
	dec hl
; add the new move
	ld [hl], b

.quit
; list updated
	pop bc
	ret
